<style>
  .feature-div {
    height:200px;
    background-color:lightgrey;
    margin:20px;
    position:relative;
  }
  .feature-description {
    width: 15%;
    height:92%;
    position:relative;
    top:4%;
    margin:4px;
    overflow-y:scroll;
  }
  .step-list {
    width:25%;
    height:100%;
    overflow-y:scroll;
    float:right;
    position:absolute;
    left:17%;
    top:0;
    padding-left:2px;
    padding-top:6px;
  }
  .project-step-border-wall {
    position:absolute;
    left:16%;
    width:3px;
    height:100%;
    background-color:black;
    top:0;
  }
  .step-status-border-wall {
    position:absolute;
    left:42.4%;
    width:2px;
    height:100%;
    background-color:darkgrey;
    top:0;
  }
  .status-updates {
    position:absolute;
    top:0;
    left:42.6%;
    height:100%;
    overflow-x:scroll;
  }
  .status-update {
    left:0.6%;
    position:relative;
    width:200px;
    height:90%;
    top:4%;
    float:left;
    margin-right:8px;
    word-wrap:break-word;
    overflow-y:scroll;
  }
  .new-update-link {
    position:absolute;
    left:43%;
    bottom:-12%;
  }
  .new-step-link {
    position:absolute;
    left:16.6%;
    bottom:-12%;
  }

  .status-time {
    position:absolute;
    top:0;
    right:0;
    font-size:12px;
  }

  .subtitle {
    margin-bottom:4px !important;
  }

  .add-task {
    position:absolute;
    left:50%;
    top:8px;
  }

  .back-to-dashboard {
    position:relative;
    left:2%;
    top:8px;
  }

  .edit-feature {
    position:absolute;
    top:0;
    left:2%;
    font-size:12px;
  }

  .edit-status-update {
    position:absolute;
    left:1%;
    top:-1%;
    font-size:12px;
  }
</style>
<body>
<%= link_to 'back to dashboard', projects_path, class: 'back-to-dashboard button is-info' %>
<%= link_to 'add task', new_feature_path(project_id: @project.id), class: 'button is-success add-task', remote: true %>
<% @project.features.each do |feature| %>
    <div style="background-color:<%= feature.color? ? feature.color : '' %>" class='feature-div'>
      <div class="feature-description box">
        <h2 class="subtitle"><%= feature.title %></h2>
        <p><%= feature.description %></p>
        <%= link_to 'edit', edit_feature_path(feature), class: 'edit-feature', remote: true %>
      </div>
      <div class="project-step-border-wall"></div>
      <%= link_to 'Add step', new_step_path(feature_id: feature.id), class: 'new-step-link', remote: true %>
      <div class="step-list">
        <% feature.steps.sort_by{|step| step.done ? 0 : 1}.each do |step| %>
            <label class="checkbox">
              <%= link_to step_path(step), method: :patch do %>
                  <% if step.done %>
                      <input type="checkbox" checked="checked">
                      <span style="text-decoration:line-through"><%= step.title %></span>
                  <% else %>
                      <input type="checkbox">
                      <%= step.title %>
                  <% end %>
              <% end %>
            </label>
            <%= link_to '', step_path(step), method: :delete, class: 'delete is-small', data: {confirm: 'are you sure?'} %>
            <br />
        <% end %>
      </div>
      <div class="step-status-border-wall"></div>
      <%= link_to 'New status', new_status_update_path(feature_id: feature.id), class: 'new-update-link', remote: true %>
      <div class="status-updates">
        <% feature.status_updates.order(created_at: :desc).each do |status_update| %>
            <div class="box status-update">
              <span class="status-time"><%= status_update.created_at.strftime("%B %e,%l:%M %p") %></span>
              <%= status_update.notes %>
              <%= link_to 'edit', edit_status_update_path(status_update), class: 'edit-status-update', remote: true %>
            </div>
        <% end %>
      </div>
    </div>
    <hr>
<% end %>
</body>

<!--
<style>
  .feature-container {
    height:240px;
    margin:20px;
  }
  .status-updates {
    width:100%;
  }
  .status-update {
    width:200px;
    height:200px;
    margin-right:8px;
    float:left;
    position:relative;
    word-wrap:break-word;
  }
</style>

<h1 class="title"><%#= @project.title %></h1>
<h2 class="subtitle"><%#= @project.description %></h2>

<%#= link_to 'add task/feature', new_feature_path(project_id: @project.id) %><br /><br />
<%# @project.features.each do |feature| %>
    <div class="columns" style="background-color:grey;margin-bottom:32px;">
      <div class="card column is-2">
        <p class="subtitle has-text-weight-bold">
          <%#= feature.title %>
        </p>
        <p>
          <%#= feature.description %>
        </p>
      </div>
      <div class="column is-2">
        <%# feature.steps.each do |step| %>
            <label class="checkbox">
              <%# if step.done %>
                  <%#= link_to step_path(step), method: :patch do %>
                    <input type="checkbox" checked="checked">
                  <%# end %>
                  <span style="text-decoration:line-through;">
                    <%#= step.title %>
                  </span>
              <%# else %>
                  <%#= link_to step_path(step), method: :patch do %>
                    <input type="checkbox">
                  <%# end %>
                  <%#= step.title %>
              <%# end %>
            </label>
            <br/>
        <%# end %>
        <%#= link_to 'add step', new_step_path(feature_id: feature.id) %>
      </div>
      <div class="column is-8 status-updates">
        <div class="box status-update">
          <%#= link_to 'new update', new_status_update_path(feature_id: feature.id) %>
        </div>
        <%# feature.status_updates.order(created_at: :desc).each do |status_update| %>
          <div class="box status-update">
            <span style="position:absolute;top:0;right:0;font-size:12px;"><%#=status_update.created_at.strftime("%B %e,%l:%M %p")%></span>
            <!--<h2 class="subtitle"><%#= status_update.title %></h2>-->
            <%#= status_update.notes %>
          <!--</div>
        <%# end %>
      </div>
    </div>-->
<%# end %>
